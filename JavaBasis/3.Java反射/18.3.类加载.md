##  类加载

###  基本介绍：

> 反射机制是java实现动态语言的关键，也就是通过反射实现类的动态加载

- 静态加载：*编译时*加载相关类；若没有相关类则报错，*依耐性强*。
- 动态加载：*运行时*加载相关类；若运行时没用到相关类则不报错，*降低依耐性*

###  类加载时机：

1. 创建对象（静态）
2. 子类被加载（静态）
3. 调用类的静态成员（静态）
4. 反射（动态加载）

###  类加载三阶段

1. 加载

   JVM将字节码从不同数据源转化为二进制字节流，加载至内存中，并生成该类的Class对象

2. 连接

   - 验证

     确保Class文件字节流包含符合JVM要求的信息；

     包括：文件格式验证（以oxcafebabe开头）、元数据验证、字节码验证、符号引用验证

     可使用-Xverify:none参数关闭类验证，以提高JVM加载效率

   -  准备

     JVM对静态变量分配内存并且*默认*初始化（不是程序给定值）【不同数据类型默认值不同：如int 0、long 0L...】。其所用内存在方法区进行分配

   - 解析

     JVM将常量池的符号引用替换成内存直接引用的过程

3. 初始化

   - 开始执行类中定义的程序代码；执行<clinit>()方法
   - <clinit>()方法由编译器按照语句在源程序出现顺序，依次收集所有静态成员的赋值语句和静态代码块中的语句，并进行合并；
   - JVM保证一个类的<clinit>()方法在多线程环境中正确的加锁、同步，若有多线程同时初始化类，则只有一个线程执行该类<clinit>()方法，其他阻塞等待，直至活动线程结束。