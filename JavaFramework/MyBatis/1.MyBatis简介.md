##  MyBatis

æè¿°ï¼šåŸºäºjavaçš„æŒä¹…å±‚ï¼ˆDAOï¼‰æ¡†æ¶

[mybatisåœ°å€](https://github.com/mybatis/mybatis-3/releases)

###  ç‰¹æ€§

1. æ”¯æŒå®šåˆ¶åŒ–SQLã€å­˜å‚¨è¿‡ç¨‹ã€é«˜çº§æ˜ å°„çš„æŒä¹…å±‚æ¡†æ¶
2. å‡ ä¹é¿å…æ‰€æœ‰JDBCä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†
3. ä½¿ç”¨ç®€å•çš„XMLæˆ–æ³¨è§£é…ç½®åŸå§‹æ˜ å°„ï¼Œå°†æ¥å£å’ŒJavaçš„pojoæ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•
4. åŠè‡ªåŠ¨åŒ–çš„ORMï¼ˆObject Relation Mappingï¼Œä¸Šè¿°3å³ä¸ºè§£é‡Šï¼‰æ¡†æ¶



###  ä¸å…¶ä»–æŒä¹…å±‚æŠ€æœ¯å¯¹æ¯”

- JDBC

  â€‹	1ï¼‰SQLå¤¹æ‚åœ¨javaä»£ç ä¸­è€¦åˆåº¦é«˜ï¼Œç¡¬ç¼–ç 

  â€‹	2ï¼‰ç»´æŠ¤æˆæœ¬é«˜ï¼Œéœ€è¦é¢‘ç¹æ”¹åŠ¨

  â€‹	3ï¼‰ä»£ç å†—ä½™åº¦é«˜ï¼Œå¼€å‘æ•ˆç‡ä½

- Hibernateï¼ˆå…¨è‡ªåŠ¨ï¼‰å’ŒJpa

  â€‹	1ï¼‰æ“ä½œç®€å•ï¼Œå¼€å‘æ•ˆç‡é«˜

  â€‹	2ï¼‰å¤æ‚sqléœ€è¦ç»•è¿‡æ¡†æ¶

  â€‹	3ï¼‰å†…éƒ¨ç”Ÿæˆsqlï¼Œä¸æ˜“åšä¼˜åŒ–å¤„ç†

  â€‹	4ï¼‰åŸºäºå…¨æ˜ å°„å…¨è‡ªåŠ¨æ¡†æ¶ï¼Œå¤§é‡å­—æ®µpojoè¿›è¡Œéƒ¨åˆ†æ˜ å°„æ¯”è¾ƒå›°éš¾

  â€‹	5ï¼‰åå°„æ“ä½œè¿‡å¤šï¼Œæ•°æ®åº“æ€§èƒ½ä¸‹é™

- Mybatis

  â€‹	1ï¼‰è½»é‡çº§ï¼Œæ€§èƒ½é«˜

  â€‹	2ï¼‰sqlä¸javaä»£ç åˆ†ç¦»ï¼ŒåŠŸèƒ½è¾¹ç•Œæ¸…æ™°

  â€‹	3ï¼‰å¼€å‘æ•ˆç‡ç•¥ä½ä¸Hibernate



###  æ­å»º

- åˆ›å»ºmavenå·¥ç¨‹

- å¼•å…¥ä¾èµ–

  ```xml
  <!--    mybatisæ ¸å¿ƒ-->
      <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>3.5.13</version>
      </dependency>
  <!--    æµ‹è¯•-->
      <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.13.1</version>
        <scope>test</scope>
      </dependency>
      <!--    mysqlé©±åŠ¨-->
      <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.33</version>
      </dependency>
  
  ```

- åˆ›å»ºMyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ˆ/src/main/resource/ï¼‰

  å»ºè®®å‘½åmybatis-config.xml

  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE configuration
          PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
          "http://mybatis.org/dtd/mybatis-3-config.dtd">
  
  <configuration>
  
      <!-- è®¾ç½®å…¨å±€é…ç½®ä¿¡æ¯ -->
      <settings>
          <setting name="cacheEnabled" value="true" /> <!-- æ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºtrue -->
          <setting name="lazyLoadingEnabled" value="true" /> <!-- æ˜¯å¦å¯ç”¨å»¶è¿ŸåŠ è½½ï¼Œé»˜è®¤ä¸ºfalse -->
          <setting name="multipleResultSetsEnabled" value="true" /> <!-- æ˜¯å¦å…è®¸å¤šç»“æœé›†è¿”å›ï¼Œé»˜è®¤ä¸ºtrue -->
          <setting name="mapUnderscoreToCamelCase" value="true" /> <!-- æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åæ³•è½¬æ¢ï¼Œé»˜è®¤ä¸ºfalse -->
          <!-- å…¶ä»–å…¨å±€é…ç½®å±æ€§... -->
      </settings>
  
      <!-- é…ç½®æ•°æ®æº -->
      <environments default="development">
          <environment id="development">
              <transactionManager type="JDBC" />
              <dataSource type="POOLED">
                  <property name="driver" value="com.mysql.jdbc.Driver" />
                  <property name="url" value="jdbc:mysql://localhost:3306/MyBatisDB" />
                  <property name="username" value="root" />
                  <property name="password" value="" />
              </dataSource>
          </environment>
      </environments>
  
      <!-- é…ç½®æ˜ å°„å™¨ï¼ˆMapperï¼‰ -->
      <mappers>
          <mapper resource="com/example/mappers/UserMapper.xml" />
          <!-- å…¶ä»–æ˜ å°„å™¨... -->
      </mappers>
  
  </configuration>
  ```

- åˆ›å»ºmapperæ¥å£ï¼ˆ/mapper/ï¼‰

  æè¿°ï¼šç›¸å½“äºdaoå±‚æ¥å£

  ```java
  public interface UserMapper {
      /**
       * æ·»åŠ ç”¨æˆ·ä¿¡æ¯
       */
      int insertUser();
  }
  ```

- åˆ›å»ºMyBatisæ˜ å°„æ–‡ä»¶ï¼ˆresource/mappers/ï¼‰

  æè¿°ï¼šORMï¼ˆObject Relationship Mappingï¼‰å¯¹è±¡å…³ç³»æ˜ å°„

  - å¯¹è±¡ï¼šjavaå®ä½“ç±»ï¼ˆpojoï¼‰

  - å…³ç³»ï¼šå…³ç³»å‹æ•°æ®åº“

  - æ˜ å°„ï¼šäºŒè€…å¯¹åº”å…³ç³»

  - | javaæ¦‚å¿µ | æ•°æ®åº“æ¦‚å¿µ |
    | -------- | ---------- |
    | ç±»       | è¡¨         |
    | å±æ€§     | å­—æ®µ/åˆ—    |
    | æ–¹æ³•     | è®°å½•/è¡Œ    |

  å»ºè®®æ˜ å°„æ–‡ä»¶ä¸mapperæ¥å£åä¸€è‡´ï¼›å¦‚ï¼šUserMapper.xml

  æ³¨ï¼šä¸¤ä¸ªå¼ºåˆ¶ä¸€è‡´ğŸ“Œ

  1. æ˜ å°„æ–‡ä»¶namespaceä¸mapperæ¥å£å…¨ç±»åä¸€è‡´
  2. æ˜ å°„æ–‡ä»¶sqlè¯­å¥idä¸mapperæ¥å£æ–¹æ³•åä¸€è‡´

- æµ‹è¯•

  ```java
  import com.loy.mybatis.mapper.UserMapper;
  import com.loy.mybatis.pojo.User;
  import org.apache.ibatis.io.Resources;
  import org.apache.ibatis.session.SqlSession;
  import org.apache.ibatis.session.SqlSessionFactory;
  import org.apache.ibatis.session.SqlSessionFactoryBuilder;
  import org.junit.Test;
  import java.io.IOException;
  import java.io.InputStream;
  public class MyBatisTest {
      @Test
      public void testMyBatis() throws IOException {
  //        åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶
          InputStream resourceAsStream = Resources.getResourceAsStream("mybatis-config.xml");
  //        è·å–SqlSessionFactoryBuilder
          SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();
  //        è·å–SqlSessionFactory
          SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(resourceAsStream);
  //        è·å–SqlSession,trueè‡ªåŠ¨æäº¤äº‹åŠ¡
          SqlSession sqlSession = sqlSessionFactory.openSession(true);
  //        è·å–mapperæ¥å£å¯¹è±¡
          UserMapper mapper = sqlSession.getMapper(UserMapper.class);
          int i = mapper.insertUser();
          System.out.println(i);
      }
  }
  ```






###  log4jæ—¥å¿—ï¼ˆlog4j.xmlï¼‰

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE log4j:configuration PUBLIC "-//LOG4J//DTD LOG4J 1.2//EN" "http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/xml/doc-files/log4j.dtd">

<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/" debug="false">

    <!-- æ§åˆ¶å°è¾“å‡º -->
    <appender name="ConsoleAppender" class="org.apache.log4j.ConsoleAppender">
        <param name="Target" value="System.out" />
        <layout class="org.apache.log4j.PatternLayout">
            <param name="ConversionPattern" value="%d %p [%c{1}] - %m%n" />
        </layout>
    </appender>

    <!-- æ–‡ä»¶è¾“å‡º -->
    <appender name="FileAppender" class="org.apache.log4j.FileAppender">
        <param name="File" value="logs/mybatis.log" />
        <param name="Append" value="true" />
        <layout class="org.apache.log4j.PatternLayout">
            <param name="ConversionPattern" value="%d %p [%c{1}] - %m%n" />
        </layout>
    </appender>
<!--MYSQLç›¸å…³ä¿¡æ¯è¾“å‡º-->
    <logger name="java.sql">
        <level value="debug" />
    </logger>
    <!-- MyBatis ç›¸å…³åŒ…æ—¥å¿—è¾“å‡ºçº§åˆ«ä¸º DEBUG -->
    <logger name="org.apache.ibatis">
        <level value="info" />
    </logger>

    <root>
        <priority value="debug" />
<!--        æ§åˆ¶å°è¾“å‡º-->
        <appender-ref ref="ConsoleAppender" />
<!--        æ–‡ä»¶è¾“å‡º-->
<!--        <appender-ref ref="FileAppender" />-->
    </root>

</log4j:configuration>
```

