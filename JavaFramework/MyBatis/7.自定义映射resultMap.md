##  resultMap

æè¿°ï¼šä½¿ç”¨resultTypeæ—¶ï¼Œè¦æ±‚å­—æ®µåä¸å±æ€§åä¸€è‡´ï¼›è€ŒresultMapå¯ä»¥ä¸ä¸€è‡´

###  è§£å†³å­—æ®µä¸å±æ€§åä¸ä¸€è‡´

####  ä¸ä½¿ç”¨resultMap

å•è¡¨

1. ä¸ºå­—æ®µèµ·åˆ«å

   ```xml
       <select id="getEmpById" resultType="Employee">
           select id,ename as empName,age from employee;
       </select>
   ```

   

2. å…¨å±€é…ç½®mybatis-config.xml

   æè¿°ï¼šä¼šå°†å­—æ®µåä¸­ `_`è‡ªåŠ¨è½¬æ¢ä¸º

   ```xml
   <settings>
       <setting name="mapUnderscoreToCamelCase" value="true"/>
   </settings>
   ```



####  ä½¿ç”¨resultMap

##### ç”¨äºå¤šå¯¹ä¸€

æ–¹å¼ï¼š

1. #####  è”æŸ¥ï¼š

   ```xml
   <select id="getEmpInfo" resultMap="empInfoResultMap">
           select employee.id,ename,age,did,name from employee left join department on employee.did=department.id where employee.id=#{id}
   </select>
   ```

   - æ–¹å¼ä¸€ï¼šçº§è”å±æ€§èµ‹å€¼

   ```xml
   <!--          æ–¹å¼1ï¼š         -->
       <resultMap id="empInfoResultMap" type="Employee">
          <!-- 
               propertyï¼štypeæŒ‡å®šçš„å®ä½“ç±»ä¸­çš„å±æ€§å
               columnï¼šæŸ¥è¯¢å‡ºçš„sqlè¯­å¥ä¸­çš„å­—æ®µå
          -->
           <id property="id" column="id"></id>
           <result property="empName" column="ename"></result>
           <result property="age" column="age"></result>
           <result property="department.id" column="did"></result>
           <result property="department.name" column="name"></result>
       </resultMap>
   ```

   - æ–¹å¼äºŒï¼šassociation

   ```xml
   <!--          æ–¹å¼2ï¼š         -->
   <resultMap id="empInfoResultMap2" type="Employee">
           <id property="id" column="id"></id>
           <result property="empName" column="ename"></result>
           <result property="age" column="age"></result>
           <!--
                association:
                  propertyï¼šå¤šå¯¹ä¸€çš„å±æ€§å
                  javaTypeï¼šå¤šå¯¹ä¸€å±æ€§ç±»å‹ğŸ“Œ
           -->
           <association property="department" javaType="Department">
               <id property="id" column="did"></id>
               <result property="name" column="name"></result>
           </association>
       </resultMap>
   ```

2. #####  åˆ†æ­¥æŸ¥è¯¢ï¼ˆæ¨èä½¿ç”¨ï¼‰ğŸ“ŒğŸ“ŒğŸ“Œ

   > ä¼˜ç‚¹ï¼šå®ç°å»¶è¿ŸåŠ è½½ï¼Œéœ€è¦æ ¸å¿ƒé…ç½®å¼€å¯
   >
   > lazyLoadingEnabledï¼šå¼€å¯åï¼Œå…³è”å¯¹è±¡ä¼šå»¶è¿ŸåŠ è½½ï¼›ä¾‹å¦‚ï¼šæŸ¥è¯¢å‘˜å·¥ä¸ä¼šæŸ¥è¯¢éƒ¨é—¨
   >
   > aggressiveLazyLoadingï¼ˆéœ€è¦å…³é—­ï¼‰ï¼šå¼€å¯æ—¶ï¼Œä»»ä½•æ–¹æ³•è°ƒç”¨éƒ½ä¼šåŠ è½½è¯¥å¯¹è±¡å…¨éƒ¨å±æ€§ï¼Œä¾‹å¦‚ï¼šæŸ¥è¯¢å‘˜å·¥ä¼šæŸ¥è¯¢éƒ¨é—¨

   ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼ˆEmployeeMapper.xmlï¼‰

   ```xml
   <!--    åˆ†æ­¥æŸ¥è¯¢
   Employee getEmpStepOne(@Param("id") Integer id);
   -->
       <select id="getEmpStepOne" resultMap="empStepResultMap">
           select * from employee where id=#{id}
       </select>
       <resultMap id="empStepResultMap" type="Employee">
           <id property="id" column="id"></id>
           <result property="empName" column="ename"></result>
           <result property="age" column="age"></result>
           <association property="department"
                        <!-- 
           			selectï¼šå°†ä½¿ç”¨com.loy.mybatis.mapper.DeptMapper.getDeptæŸ¥è¯¢ï¼Œç»“æœèµ‹å€¼ç»™propertyæŒ‡å‘çš„å±æ€§
           			columnï¼šä¸ºæŸ¥è¯¢å‡ºçš„didï¼Œå°†ä½œä¸ºgetDeptçš„å½¢å‚ä¼ å…¥
           			fetchType:lazy(æ‡’åŠ è½½)|eagerï¼ˆç›´æ¥åŠ è½½ï¼‰ğŸ“Œ
           			 -->
                        select="com.loy.mybatis.mapper.DeptMapper.getDept" 
                        column="did"
           			 fetchType="lazy"
           ></association>
       </resultMap>
   ```

   ç¬¬äºŒæ­¥ï¼šæ ¹æ®å‘˜å·¥ä¿¡æ¯ä¸­didæŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯ï¼ˆDepartmentMapper.xmlï¼‰

   ```xml
   <!--    Department getDept(@Param("did") Integer did);-->
       <select id="getDept" resultType="Department">
           select id,name as deptName from department where id=#{did};
       </select>
   ```

   æµ‹è¯•ï¼š

   ```java
   public void testLazyLoading(){
           Employee empStepOne = mapperObj.getEmpStepOne(1);
           String empName = empStepOne.getEmpName();
   
           System.out.println(empName);
           System.out.println("============");
           System.out.println(empStepOne.getDepartment());
       //å½“ä½¿ç”¨åˆ°æ‡’åŠ è½½å¯¹è±¡æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå¯¹åº”sqlğŸ“ŒğŸ“ŒğŸ“Œ
       }
   ```



#####  ç”¨äºä¸€å¯¹å¤š

æ–¹å¼ï¼š

1. #####  collection

   ```xml
   
   <!--    Department getDeptAndEmp(@Param("did") Integer did);-->
   <select id="getDeptAndEmp" resultMap="deptAndEmpResultMap">
       select * from department left join employee on department.id=employee.did where department.id=#{did}
   </select>
       <resultMap id="deptAndEmpResultMap" type="Department">
           <id property="id" column="id"></id>
           <result property="deptName" column="name"></result>
   <!--        ofTypeï¼šé›†åˆä¸­çš„ç±»å‹-->ğŸ“Œ
           <collection property="employeeList" ofType="Employee">
               <id property="id" column="employee.id"></id>
               <result property="empName" column="ename"></result>
               <result property="age" column="age"></result>
           </collection>
       </resultMap>
   ```

2. #####  åˆ†æ­¥æŸ¥è¯¢

   ç¬¬ä¸€æ­¥ï¼šæŸ¥å‡ºéƒ¨é—¨ä¿¡æ¯

   ```xml
   <!--    åˆ†æ­¥æŸ¥è¯¢ç¬¬ä¸€æ­¥-->
   <!--    Department getDEStepOne(@Param("deptName") String deptName);-->
   <select id="getDEStepOne" resultMap="stepOneResultMap">
       select * from department where name =#{deptName};
   </select>
       <resultMap id="stepOneResultMap" type="Department">
           <id property="id" column="id"></id>
           <result property="deptName" column="name"></result>
           <collection property="employeeList"
                       select="com.loy.mybatis.mapper.FiledMappingAttr.getDeptAndEmpStepTwo"
                       column="id"
           ></collection>
       </resultMap>
   ```

   ç¬¬äºŒæ­¥ï¼šæ ¹æ®éƒ¨é—¨idæŸ¥å‡ºå‘˜å·¥ä¿¡æ¯

   ```xml
   <!--    ä¸€å¯¹å¤šåˆ†å¸ƒæŸ¥è¯¢ç¬¬äºŒæ­¥-->
   <!--    List<Employee> getDeptAndEmpStepTwo(@Param("did") Integer did);-->
       <select id="getDeptAndEmpStepTwo" resultType="Employee">
           select id,ename as empName,age from employee where did=#{did};
       </select>
   ```

   æµ‹è¯•ï¼š

   ```java
    public void testStepResultMap(){
           Department department = mapperObj1.getDEStepOne("æŠ€æœ¯éƒ¨");
           System.out.println(department.getDeptName());
       }
   ```

   



 

