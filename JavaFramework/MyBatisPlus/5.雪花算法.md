##  雪花算法

背景：需要合适方案应对数据规模增长，解决逐渐增长的访问压力和数据量

###  数据库扩展方式

- 业务分库
- 主从复制
- 数据库分表



###  数据库分表

单表数据拆分两种方式：

- 垂直分表

  描述：当某些字列不常用

- 水平分表

  描述：当数据量到达一定数量时进行水平分表

  引发问题：全局唯一id如何处理

  解决方案：

  1. 主键自增

     - 以id为例，按照100范围分段；1~99放入表1，以此内推；一般根据业务需求选取分段大小
     - 复杂点：分段大小选取，太小导致切分表过多增加维护复杂度，太大单表性能出现问题
     - 优点：可以随数据增加平滑扩展新表，原数据不动
     - 缺点：分布不均匀，到有101条数据，表1存储100条，而表2只存放1条数据

  2. 取模

     - 假如开始就规划十张表，根据id%10的值将该数据放入哪个数据库
     - 复杂点：初始表数量的确定，表太多增加维护复杂度，太少出现单表性能问题
     - 优点：分布均匀
     - 缺点：扩充新表麻烦，所有数据需要重新分布

  3. #####  雪花算法📌

     > 描述：由Twitter公布的分布式主键生成算法，能够保证不同表主键不重复性，以及相同表的主键有序性

     - 核心思想：

       长度共64bit；

       首先符号位1bit标识；

       41bit时间戳（毫秒级）存储当前时间到时间戳开始的差值；

       10bit机器的id（5bit数据中心，5bit机器id）；

       12bit毫秒内的流水号

     - **优点：整体上按时间自增，并且分布式系统内不会产生id碰撞，效率较高**